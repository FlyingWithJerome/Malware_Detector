'''
extract_manifest.py

This module helps extract the
'''

import os
import os.path
import subprocess
import shutil

def do_copy():

    base_dir = "friendly_apk"

    sample_collections =\
    [name for name in os.listdir(base_dir) if not name.startswith(".")]

    for collection in sample_collections:
        # print("--------------------------------")
        # print("On Collection:", collection)

        current_dir = os.path.join(base_dir, collection)

        # for file in os.listdir(current_dir): 
        if not os.path.isdir(current_dir):
            print("On file", collection)
            file_serial = collection.strip(".apk")
            try:
                subprocess.check_output(
                    "bash apktool.sh d {} -f -o temp"\
                    .format(os.path.join(current_dir)).split()
                )
                shutil.copy("temp/AndroidManifest.xml", "friendly_manifest")

                os.rename("friendly_manifest/AndroidManifest.xml", "friendly_manifest/{}"\
                .format(file_serial + "_manifest.xml"))

                shutil.rmtree("temp")
            except subprocess.CalledProcessError as e:
                print(e)


if __name__ == "__main__":
    do_copy()
